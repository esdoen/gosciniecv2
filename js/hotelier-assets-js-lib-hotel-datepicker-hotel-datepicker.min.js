!function(t,e,a){"use strict";t.fn.hotelDatePicker=function(n){function s(e,n){return e.target===n||n.childNodes!==a&&t.inArray(e.target,n.childNodes)>=0}function r(){function e(e){var a=t(e).parents("table").hasClass("month2"),s=a?n.month2:n.month1;s=I(s),!B&&!a&&T(s,n.month2)>=0||P(s)||(Y(s,a?"month2":"month1"),b(),M())}function a(e){var a=t(e).parents("table").hasClass("month2"),s=a?n.month2:n.month1;s=N(s),a&&T(s,n.month1)<=0||P(s)||(Y(s,a?"month2":"month1"),b(),M())}var r=this,d=t(this);if(d.data("hdp-opened"))return void k();d.data("hdp-opened",!0),z=F().hide(),z.append('<div class="date-range-length-tip"></div>'),z.delegate(".day","mouseleave",function(){z.find(".date-range-length-tip").hide()}),n.container?t(n.container).append(z):r.parent().append(z);var i=new Date;n.startDate&&T(i,n.startDate)<0&&(i=n.startDate),n.endDate&&T(I(i),n.endDate)>0&&(i=N(n.endDate)),Y(i,"month1"),Y(I(i),"month2");var o="";o=S(n.minDays&&n.maxDays?"default-range":n.minDays?"default-more":"default-default"),z.find(".default-top").html(o.replace(/\%d/,n.minDays-1).replace(/\%d/,n.maxDays-1)),B?z.addClass("single-month"):z.addClass("two-months"),z.click(function(t){t.stopPropagation()}),t(document).bind("click.datepicker",function(t){s(t,r[0])||z.is(":visible")&&k()}),z.find(".next").click(function(){e(this)}),z.find(".prev").click(function(){a(this)}),z.delegate(".day","click",function(){h(t(this))}),z.delegate(".day","mouseenter",function(){p(t(this))}),z.attr("unselectable","on").css("user-select","none").bind("selectstart",function(t){return t.preventDefault(),!1}),z.find(".apply-btn").click(function(){k();var e=C(new Date(n.start))+n.separator+C(new Date(n.end));t(r).trigger("datepicker-apply",{value:e,date1:new Date(n.start),date2:new Date(n.end)})})}function d(){return z}function i(e){o(),z.slideDown(e,function(){t(U).trigger("datepicker-opened",{relatedTarget:z})}),t(U).trigger("datepicker-open",{relatedTarget:z}),b(),M()}function o(){var t=n.getValue.call(q),e=t?t.split(n.separator):"";if(e&&e.length>=2){var a=n.format;a.match(/Do/)&&(a=a.replace(/Do/,"D"),e[0]=e[0].replace(/(\d+)(th|nd|st)/,"$1"),e[1]=e[1].replace(/(\d+)(th|nd|st)/,"$1")),Q=!1,y(fecha.parse(e[0],a),fecha.parse(e[1],a)),Q=!0}}function l(){n.start=!1,n.end=!1,z.find(".day.checked").removeClass("checked"),z.find(".day.last-date-selected").removeClass("last-date-selected"),z.find(".day.first-date-selected").removeClass("first-date-selected"),n.setValue.call(q,""),v(),g(),b()}function h(e){if(!e.hasClass("invalid")){var a=e.attr("time");if(e.addClass("checked"),n.start&&n.end||!n.start&&!n.end?(n.start=a,n.end=!1):n.start&&(n.end=a),n.start&&n.end&&n.start>n.end){var s=n.end;n.end=n.start,n.start=s}n.start=parseInt(n.start),n.end=parseInt(n.end),m(),n.start&&!n.end&&(t(U).trigger("datepicker-first-date-selected",{date1:new Date(n.start)}),p(e)),f(a),v(),g(),b(),u()}}function c(t){if(t=parseInt(t,10),n.startDate&&x(t,n.startDate)<0)return!1;if(n.endDate&&x(t,n.endDate)>0)return!1;if(n.start&&!n.end){if(n.maxDays>0&&D(t,n.start)>n.maxDays)return!1;if(n.minDays>0&&D(t,n.start)<n.minDays)return!1;if(n.selectForward&&t<n.start)return!1}return!0}function f(){return z.find(".day.invalid.tmp").removeClass("tmp invalid").addClass("valid"),n.start&&!n.end&&z.find(".day.toMonth.valid").each(function(){var e=parseInt(t(this).attr("time"),10);c(e)?t(this).addClass("valid tmp").removeClass("invalid"):t(this).addClass("invalid tmp").removeClass("valid")}),!0}function p(e){var a=parseInt(e.attr("time")),s="";if(e.hasClass("has-tooltip")&&e.attr("data-tooltip"))s='<span style="white-space:nowrap">'+e.attr("data-tooltip")+"</span>";else if(!e.hasClass("invalid")&&(z.find(".day").each(function(){var e=parseInt(t(this).attr("time"));e===a?t(this).addClass("hovering"):t(this).removeClass("hovering"),n.start&&!n.end&&(n.start<e&&a>=e||n.start>e&&e>=a)?t(this).addClass("hovering"):t(this).removeClass("hovering")}),n.start&&!n.end)){var r=D(a,n.start)-1;if(n.hoveringTooltip)if("function"==typeof n.hoveringTooltip)s=n.hoveringTooltip(r,n.start,a);else if(n.hoveringTooltip===!0&&r>0){var d=S(1===r?"night":"nights");s=r+" "+d}}if(s){var i=e.offset(),o=z.offset(),l=i.left-o.left,h=i.top-o.top;l+=e.width()/2;var c=z.find(".date-range-length-tip"),f=c.css({visibility:"hidden",display:"none"}).html(s).width(),p=c.height();l-=f/2,h-=p,setTimeout(function(){c.css({left:l,top:h,display:"block",visibility:"visible"})},10)}else z.find(".date-range-length-tip").hide()}function m(){z.find(".day.hovering").removeClass("hovering"),z.find(".date-range-length-tip").hide()}function u(){Q&&n.start&&n.end&&n.autoClose&&k()}function v(){var t=Math.ceil((n.end-n.start)/864e5)+1;n.maxDays&&t>n.maxDays?(n.start=!1,n.end=!1,z.find(".day").removeClass("checked"),z.find(".drp_top-bar").removeClass("normal").addClass("error").find(".error-top").html(S("less-than").replace("%d",n.maxDays-1))):n.minDays&&t<n.minDays?(n.start=!1,n.end=!1,z.find(".day").removeClass("checked"),z.find(".drp_top-bar").removeClass("normal").addClass("error").find(".error-top").html(S("more-than").replace("%d",n.minDays-1))):n.start||n.end?z.find(".drp_top-bar").removeClass("error").addClass("normal"):z.find(".drp_top-bar").removeClass("error").removeClass("normal"),n.start&&n.end?z.find(".apply-btn").removeClass("disabled"):z.find(".apply-btn").addClass("disabled")}function g(e,a){if(z.find(".start-day").html("..."),z.find(".end-day").html("..."),z.find(".selected-days").hide(),n.start&&z.find(".start-day").html(C(new Date(parseInt(n.start)))),n.end&&z.find(".end-day").html(C(new Date(parseInt(n.end)))),n.start&&n.end){var s=D(n.end,n.start)-1,r=1===s?s+" "+S("night"):s+" "+S("nights");z.find(".selected-days").show().find(".selected-days-num").html(r),z.find(".apply-btn").removeClass("disabled");var d=C(new Date(n.start))+n.separator+C(new Date(n.end));n.setValue.call(q,d,C(new Date(n.start)),C(new Date(n.end))),Q&&!a&&t(U).trigger("datepicker-change",{value:d,date1:new Date(n.start),date2:new Date(n.end)})}else e?z.find(".apply-btn").removeClass("disabled"):z.find(".apply-btn").addClass("disabled")}function D(t,e){return Math.abs(_(t)-_(e))+1}function y(t,e,a){if(t.getTime()>e.getTime()){var s=e;e=t,t=s,s=null}var r=!0;return n.startDate&&x(t,n.startDate)<0&&(r=!1),n.endDate&&x(e,n.endDate)>0&&(r=!1),r?(n.start=t.getTime(),n.end=e.getTime(),x(t,e)>0&&0===T(t,e)&&(e=I(t)),0===T(t,e)&&(e=I(t)),Y(t,"month1"),Y(e,"month2"),b(),M(),v(),g(!1,a),void u()):(Y(n.startDate,"month1"),Y(I(n.startDate),"month2"),b(),void M())}function b(){(n.start||n.end)&&z.find(".day").each(function(){var e=parseInt(t(this).attr("time")),a=n.start,s=n.end;n.start&&n.end&&s>=e&&e>=a||n.start&&!n.end&&fecha.format(a,"YYYY-MM-DD")===fecha.format(e,"YYYY-MM-DD")?t(this).addClass("checked"):t(this).removeClass("checked"),n.start&&fecha.format(a,"YYYY-MM-DD")===fecha.format(e,"YYYY-MM-DD")?t(this).addClass("first-date-selected"):t(this).removeClass("first-date-selected"),n.end&&fecha.format(s,"YYYY-MM-DD")===fecha.format(e,"YYYY-MM-DD")?t(this).addClass("last-date-selected"):t(this).removeClass("last-date-selected")})}function Y(t,e){var a=w(t.getMonth());z.find("."+e+" .month-name").html(a+" "+t.getFullYear()),z.find("."+e+" tbody").html(J(t)),n[e]=t,f()}function w(t){return S("month-names")[t]}function C(t){return fecha.format(t,n.format)}function M(){var t=parseInt(fecha.format(n.month1,"YYYYMM")),e=parseInt(fecha.format(n.month2,"YYYYMM")),a=Math.abs(t-e),s=a>1&&89!==a;s?z.removeClass("no-prev-next"):z.addClass("no-prev-next")}function k(){t(z).slideUp(n.duration,function(){t(U).data("hdp-opened",!1),t(U).trigger("datepicker-closed",{relatedTarget:z})}),t(U).trigger("datepicker-close",{relatedTarget:z})}function T(t,e){var a=parseInt(fecha.format(t,"YYYYMM"))-parseInt(fecha.format(e,"YYYYMM"));return a>0?1:0===a?0:-1}function x(t,e){var a=parseInt(fecha.format(t,"YYYYMMDD"))-parseInt(fecha.format(e,"YYYYMMDD"));return a>0?1:0===a?0:-1}function I(t){var e=new Date(t.valueOf());return new Date(e.setMonth(e.getMonth()+1))}function N(t){var e=new Date(t.valueOf());return new Date(e.setMonth(e.getMonth()-1))}function F(){var e='<div class="hdp-wrapper';return n.extraClass&&(e+=" "+n.extraClass+" "),n.showTopbar||(e+=" no-topbar "),e+='">',n.showTopbar&&(e+='<div class="drp_top-bar">',e+='<div class="normal-top"><span>'+S("selected")+' </span> <strong class="start-day">...</strong>',e+=' <span class="separator-day">'+n.separator+'</span> <strong class="end-day">...</strong> <em class="selected-days">(<span class="selected-days-num">3</span>)</em>',e+="</div>",e+='<div class="error-top">error</div><div class="default-top">default</div>',e+='<input type="button" class="apply-btn disabled hide" value="'+S("apply")+'" />',e+="</div>"),e+='<div class="month-wrapper"><table class="month1" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th><span class="prev">&lt;</span></th><th colspan="5" class="month-name"></th><th><span class="next">&gt;</span></th></tr><tr class="week-name">'+O()+"</thead><tbody></tbody></table>",V()&&(e+='<table class="month2" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th><span class="prev">&lt;</span></th><th colspan="5" class="month-name"></th><th><span class="next">&gt;</span></th></tr><tr class="week-name">'+O()+"</thead><tbody></tbody></table>"),e+='<div style="clear:both;height:0;font-size:0;"></div>',e+="</div>",e+="</div>",t(e)}function O(){return"monday"===n.startOfWeek?"<th>"+S("day-names")[1]+"</th><th>"+S("day-names")[2]+"</th><th>"+S("day-names")[3]+"</th><th>"+S("day-names")[4]+"</th><th>"+S("day-names")[5]+"</th><th>"+S("day-names")[6]+"</th><th>"+S("day-names")[0]+"</th>":"<th>"+S("day-names")[0]+"</th><th>"+S("day-names")[1]+"</th><th>"+S("day-names")[2]+"</th><th>"+S("day-names")[3]+"</th><th>"+S("day-names")[4]+"</th><th>"+S("day-names")[5]+"</th><th>"+S("day-names")[6]+"</th>"}function P(t){var e=new Date(t.valueOf());return n.startDate&&new Date(e.getFullYear(),e.getMonth()+1,0,23,59,59)<n.startDate?!0:n.endDate&&new Date(e.getFullYear(),e.getMonth(),1)>n.endDate?!0:!1}function V(){return!B}function W(t){var e=t,a="";for(var n in t)e.hasOwnProperty(n)&&(a+=n+'="'+e[n]+'" ');return a}function _(t){return Math.floor(j(t)/864e5)}function j(t){return"object"==typeof t&&t.getTime&&(t=t.getTime()),"string"!=typeof t||t.match(/\d{13}/)||(t=fecha.parse(t,n.format).getTime()),t=parseInt(t,10)-60*(new Date).getTimezoneOffset()*1e3}function A(t,e){var a=new Date(t);return a.setDate(a.getDate()+e),a}function J(t){var e=[];t.setDate(1);var a,s=t.getDay();if(0===s&&"monday"===n.startOfWeek&&(s=7),s>0)for(var r=s;r>0;r--){var d=new Date(t.getTime()-864e5*r);a=c(d.getTime()),n.startDate&&x(d,n.startDate)<0&&(a=!1),n.endDate&&x(d,n.endDate)>0&&(a=!1),e.push({date:d,type:"lastMonth",day:d.getDate(),time:d.getTime(),valid:a})}for(var i=t.getMonth(),o=0;40>o;o++){var l=A(t,o);a=c(l.getTime()),n.startDate&&x(l,n.startDate)<0&&(a=!1),n.endDate&&x(l,n.endDate)>0&&(a=!1),e.push({date:l,type:l.getMonth()===i?"toMonth":"nextMonth",day:l.getDate(),time:l.getTime(),valid:a})}for(var h=[],f=0;6>f&&"nextMonth"!==e[7*f].type;f++){h.push("<tr>");for(var p=0;7>p;p++){var m="monday"===n.startOfWeek?p+1:p,u=e[7*f+m],v=fecha.format(u.time,n.format)===fecha.format(new Date,n.format);u.extraClass="",u.tooltip="";var g={time:u.time,"data-tooltip":u.tooltip,"class":"day "+u.type+" "+u.extraClass+" "+(u.valid?"valid":"invalid")+" "+(v?"real-today":"")};h.push("<td><div "+W(g)+">"+R(u.time,u.day)+"</div></td>")}h.push("</tr>")}return h.join("")}function R(t,e){return n.showDateFilter&&"function"==typeof n.showDateFilter?n.showDateFilter(t,e):e}function S(t){return t in n.i18n?n.i18n[t]:""}n||(n={}),n=t.extend(!0,{format:"YYYY-MM-DD",separator:" - ",startOfWeek:"sunday",getValue:function(){return t(this).val()},setValue:function(e){t(this).attr("readonly")||t(this).is(":disabled")||e===t(this).val()||t(this).val(e)},startDate:new Date,endDate:!1,minNights:1,maxNights:0,selectForward:!1,container:"",duration:200,hoveringTooltip:!0,showTopbar:!0,i18n:{selected:"Your stay:",night:"Night",nights:"Nights",apply:"Close","day-names":["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],"month-names":["January","February","March","April","May","June","July","August","September","October","November","December"],"less-than":"Date range should not be more than %d night(s)","more-than":"Date range should not be less than %d night(s)","default-more":"Please select a date range longer than %d night(s)","default-range":"Please select a date range between %d and %d night(s)","default-default":"Please select a date range"}},n),n.start=!1,n.end=!1,n.minDays=n.minNights>1?n.minNights+1:2,n.maxDays=n.maxNights>1?n.maxNights+1:0,n.startDate&&"string"==typeof n.startDate&&(n.startDate=fecha.parse(n.startDate,n.format)),n.endDate&&"string"==typeof n.endDate&&(n.endDate=fecha.parse(n.endDate,n.format));var z,$,Q=!1,U=this,q=t(U).get(0),B=t(e).width()<480,E="ontouchstart"in e||navigator.msMaxTouchPoints;return B=t(e).width()<480,E&&(n.hoveringTooltip=!1),t(this).unbind(".datepicker").bind("click.datepicker",function(){var t=z.is(":visible");t||i(n.duration)}).bind("change.datepicker",function(){o()}).bind("keyup.datepicker",function(){try{clearTimeout($)}catch(t){}$=setTimeout(function(){o()},2e3)}),r.call(this),t(this).data("dateRangePicker",{setDateRange:function(t,e,a){"string"==typeof t&&"string"==typeof e&&(t=fecha.parse(t,n.format),e=fecha.parse(e,n.format)),y(t,e,a)},clear:l,close:k,open:i,getDatePicker:d,destroy:function(){t(U).unbind(".datepicker"),t(U).data("dateRangePicker",""),t(U).data("hdp-opened",null),z.remove(),t(document).unbind("click.datepicker",k)}}),this}}(jQuery,window);
